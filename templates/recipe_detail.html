<!-- templates/recipe_detail.html -->
<!-- Premium Recipe Detail View -->

{% extends "base.html" %}
{% block content %}

<!-- Recipe Hero Section -->
<div class="pw-card pw-card-gradient-border animate-fade-in" style="--delay: 0.1s">
  <!-- Gradient accent bar -->
  <div
    style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--pw-primary), #8b5cf6, #ec4899); border-radius: 16px 16px 0 0;">
  </div>

  <div style="padding-top: 12px;">
    <!-- Title and Description -->
    <div style="text-align: center; margin-bottom: 28px;">
      <h1
        style="font-size: 36px; font-weight: 800; margin: 0 0 12px; background: linear-gradient(135deg, var(--pw-primary), #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
        {{ recipe.title }}
      </h1>
      {% if recipe.description %}
      <p style="font-size: 18px; color: var(--pw-text-muted); margin: 0; line-height: 1.6;">
        {{ recipe.description }}
      </p>
      {% endif %}
    </div>

    <!-- Tags with Bubble Design -->
    {% if tags %}
    <div class="pw-tags-container" style="justify-content: center; margin-bottom: 32px;">
      {% for t in tags %}
      <span
        class="pw-tag-bubble {% if 'vegetarian' in t.lower() %}pw-tag-vegetarian{% elif 'quick' in t.lower() %}pw-tag-quick{% elif 'dessert' in t.lower() %}pw-tag-dessert{% elif 'healthy' in t.lower() %}pw-tag-healthy{% elif 'spicy' in t.lower() %}pw-tag-spicy{% elif 'comfort' in t.lower() %}pw-tag-comfort{% endif %}"
        style="--tag-index: {{ loop.index0 }}">
        {{ t }}
      </span>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Match Percentage with Progress Ring -->
    <div style="text-align: center; margin-bottom: 32px;">
      <div
        style="display: inline-flex; align-items: center; gap: 20px; padding: 20px 32px; background: var(--pw-surface-2); border-radius: 16px;">
        <div style="position: relative; width: 80px; height: 80px;">
          <svg width="80" height="80" style="transform: rotate(-90deg);">
            <circle cx="40" cy="40" r="34" fill="none" stroke="var(--pw-border)" stroke-width="6"></circle>
            {% if match.match_pct >= 70 %}
            <circle cx="40" cy="40" r="34" fill="none" stroke="#22c55e" stroke-width="6"
              stroke-dasharray="{{ (match.match_pct / 100) * 213.6 }} 213.6" stroke-linecap="round"
              style="transition: stroke-dasharray 1s ease;"></circle>
            {% elif match.match_pct >= 40 %}
            <circle cx="40" cy="40" r="34" fill="none" stroke="#f59e0b" stroke-width="6"
              stroke-dasharray="{{ (match.match_pct / 100) * 213.6 }} 213.6" stroke-linecap="round"
              style="transition: stroke-dasharray 1s ease;"></circle>
            {% else %}
            <circle cx="40" cy="40" r="34" fill="none" stroke="#6b7280" stroke-width="6"
              stroke-dasharray="{{ (match.match_pct / 100) * 213.6 }} 213.6" stroke-linecap="round"
              style="transition: stroke-dasharray 1s ease;"></circle>
            {% endif %}
          </svg>
          {% if match.match_pct >= 70 %}
          <div
            style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 800; color: #22c55e;">
            {% elif match.match_pct >= 40 %}
            <div
              style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 800; color: #f59e0b;">
              {% else %}
              <div
                style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 800; color: #6b7280;">
                {% endif %}
                {{ match.match_pct }}%
              </div>
            </div>
            <div style="text-align: left;">
              <div style="font-size: 14px; color: var(--pw-text-muted); margin-bottom: 4px;">Ingredient Match</div>
              <div style="font-size: 18px; font-weight: 700;">{{ match.have_count }}/{{ match.total }} ingredients</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Two Column Layout -->
    <div class="grid-2">
      <!-- Left Column: Ingredients -->
      <div class="pw-card animate-fade-in" style="--delay: 0.2s; background: var(--pw-surface-2);">
        <div class="pw-card-header">
          <span class="pw-card-icon">ü•ò</span>
          <h2>Ingredients</h2>
        </div>

        <ul style="list-style: none; padding: 0; margin: 0;">
          {% for i in ingredients %}
          <li class="animate-slide-left"
            style="--delay: {{ loop.index * 0.05 }}s; display: flex; align-items: center; gap: 12px; padding: 14px 0; border-bottom: 1px dashed var(--pw-border);">
            <span
              style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; background: var(--pw-primary-100); color: var(--pw-primary); border-radius: 50%; font-size: 12px; font-weight: 700;">‚úì</span>
            <span style="font-weight: 700; color: var(--pw-primary); min-width: 100px;">{{ i.amount }} {{ i.unit or ''
              }}</span>
            <span style="color: var(--pw-text);">{{ i.ingredient_name }}</span>
          </li>
          {% endfor %}
        </ul>

        <!-- Have/Missing Summary -->
        <div style="margin-top: 24px; padding-top: 24px; border-top: 2px solid var(--pw-border);">
          <h3 style="font-size: 16px; font-weight: 700; margin: 0 0 16px; color: var(--pw-text);">You Have</h3>
          {% if match.have %}
          <ul style="list-style: none; padding: 0; margin: 0 0 20px;">
            {% for h in match.have %}
            <li style="font-size: 14px; padding: 8px 0; color: var(--pw-text-muted);">
              <span style="color: #22c55e; font-weight: 600;">‚úì</span> {{ h.name }}
              <span style="font-size: 12px;">(need {{ h.need }} {{ h.unit or '' }}, have {{ h.have }})</span>
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <p style="font-size: 14px; color: var(--pw-text-muted); font-style: italic;">All ingredients available!</p>
          {% endif %}

          {% if match.missing %}
          <h3 style="font-size: 16px; font-weight: 700; margin: 0 0 16px; color: var(--pw-text);">Missing</h3>
          <ul style="list-style: none; padding: 0; margin: 0;">
            {% for m in match.missing %}
            <li style="font-size: 14px; padding: 8px 0; color: var(--pw-text-muted);">
              <span style="color: #ef4444; font-weight: 600;">‚úó</span> {{ m.name }}
              <span style="font-size: 12px;">(need {{ m.need }} {{ m.unit or '' }}, short {{ m.short }})</span>
            </li>
            {% endfor %}
          </ul>
          {% endif %}
        </div>
      </div>

      <!-- Right Column: Steps -->
      <div class="pw-card animate-fade-in" style="--delay: 0.3s;">
        <div class="pw-card-header">
          <span class="pw-card-icon">üìù</span>
          <h2>Instructions</h2>
        </div>

        <div class="prose" style="line-height: 1.8;">
          {{ steps_html|safe }}
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="pw-card animate-fade-in" style="--delay: 0.4s; margin-top: 24px;">
      <form method="post" style="display: flex; gap: 12px; flex-wrap: wrap; justify-content: center;">
        <button name="action" value="add_missing" type="submit" class="pw-btn-primary pw-btn-ripple pw-btn-press"
          style="flex: 1; min-width: 200px;">
          <span class="pw-btn-icon">üõí</span>
          <span>Add Missing to Shopping</span>
        </button>



        <button name="action" value="toggle_fav" type="submit" class="pw-btn-secondary pw-btn-press"
          style="min-width: 150px;">
          <span class="pw-btn-icon">{{ '‚ù§Ô∏è' if is_fav else 'ü§ç' }}</span>
          <span>{{ 'Unfavourite' if is_fav else 'Favourite' }}</span>
        </button>
      </form>
    </div>

    <!-- Back Link -->
    <div style="text-align: center; margin-top: 24px;">
      <a href="{{ url_for('recipes') }}" class="pw-action-link" style="font-size: 16px;">
        <span>‚Üê</span>
        <span>Back to Recipes</span>
      </a>
    </div>

    {% endblock %}